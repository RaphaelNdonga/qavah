(this.webpackJsonpfrontend=this.webpackJsonpfrontend||[]).push([[0],{38:function(e){e.exports=JSON.parse('{"4":"0xE0799015aAB3B9dfd0db4205b8E264F768951f0a","1337":"0x9fE46736679d2D9a65F0992F2272dE9f3c7fa6e0","44787":"0x668B66841a835FE0D50d7dC641ffdBAF117E8726"}')},39:function(e){e.exports=JSON.parse('{"a":[{"anonymous":false,"inputs":[{"indexed":true,"internalType":"bytes32","name":"id","type":"bytes32"},{"indexed":false,"internalType":"address","name":"from","type":"address"}],"name":"FundsClaimed","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"bytes32","name":"id","type":"bytes32"},{"indexed":false,"internalType":"address","name":"from","type":"address"}],"name":"FundsDonated","type":"event"},{"anonymous":false,"inputs":[{"indexed":false,"internalType":"bytes32","name":"id","type":"bytes32"},{"indexed":true,"internalType":"address","name":"from","type":"address"}],"name":"ProjectCreated","type":"event"},{"inputs":[{"internalType":"bytes32","name":"id","type":"bytes32"}],"name":"claimProjectFunds","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"string","name":"title","type":"string"},{"internalType":"string","name":"description","type":"string"},{"internalType":"uint256","name":"requestedAmount","type":"uint256"},{"internalType":"string","name":"encodedImage","type":"string"},{"internalType":"string","name":"imageMeta","type":"string"}],"name":"createProject","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"bytes32","name":"id","type":"bytes32"}],"name":"donateToProject","outputs":[],"stateMutability":"payable","type":"function"},{"inputs":[{"internalType":"bytes32","name":"id","type":"bytes32"}],"name":"getProject","outputs":[{"components":[{"internalType":"bytes32","name":"id","type":"bytes32"},{"internalType":"address","name":"creator","type":"address"},{"internalType":"string","name":"title","type":"string"},{"internalType":"uint256","name":"requestedAmount","type":"uint256"},{"internalType":"string","name":"description","type":"string"},{"internalType":"string","name":"encodedImage","type":"string"},{"internalType":"string","name":"imageMeta","type":"string"},{"internalType":"uint256","name":"fundedAmount","type":"uint256"},{"internalType":"uint256","name":"claimedAmount","type":"uint256"},{"internalType":"address[]","name":"donators","type":"address[]"},{"internalType":"uint256[]","name":"donatedAmounts","type":"uint256[]"}],"internalType":"struct Contract.Project","name":"","type":"tuple"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"getProjects","outputs":[{"components":[{"internalType":"bytes32","name":"id","type":"bytes32"},{"internalType":"address","name":"creator","type":"address"},{"internalType":"string","name":"title","type":"string"},{"internalType":"uint256","name":"requestedAmount","type":"uint256"},{"internalType":"string","name":"description","type":"string"},{"internalType":"string","name":"encodedImage","type":"string"},{"internalType":"string","name":"imageMeta","type":"string"},{"internalType":"uint256","name":"fundedAmount","type":"uint256"},{"internalType":"uint256","name":"claimedAmount","type":"uint256"},{"internalType":"address[]","name":"donators","type":"address[]"},{"internalType":"uint256[]","name":"donatedAmounts","type":"uint256[]"}],"internalType":"struct Contract.Project[]","name":"","type":"tuple[]"}],"stateMutability":"view","type":"function"}]}')},47:function(e,t,n){e.exports=n(66)},53:function(e,t,n){},54:function(e,t){},63:function(e,t){},66:function(e,t,n){"use strict";n.r(t);var r,a=n(3),i=n.n(a),o=n(37),s=n.n(o),c=n(16),u=n(7),l=n(2),d=n.n(l),m=n(17),p=n(29),f=n(13),h=n(8),y=n(38),g=n(39),b=Object(a.createContext)(),w=function(e){return y[e]},v=function(){return g.a},T=function(e){return{4:"ETH",1337:"ETH",44787:"CELO"}[e]},E=function(e){return e.replace(/(\d+)([ \w])/g,(function(e,t,n){return n.repeat(t)}))};(r={treeFromText:function(e){return new r.TreeBuilder(e).build()}}).CoreHelpers={isArray:function(e){return!(!e||e.constructor!==Array)},lpad:function(e,t){for(t=t||8;e.length<t;)e="0"+e;return e}},r.Tree=function(e){return this.root=e,this.root=this.root||new r.Tree.Node,this},r.Tree.prototype.encode=function(e){return this.bitStringToString(this.encodeBitString(e))},r.Tree.prototype.decode=function(e){var t,n,r,a,i,o;for(a=this.stringToBitString(e),i="",o=this.root,t=0,r=(n=a.split("")).length;t<r;t++)(o=o["0"===n[t]?"left":"right"]).isLeaf()&&(i+=o.value,o=this.root);return i},r.Tree.prototype.encodeBitString=function(e){var t,n,r,a,i;for(i="",t=0,r=(n=e.split("")).length;t<r;t++)a=n[t],i+=this.bitValue(a);return i},r.Tree.prototype.bitStringToString=function(e){var t,n,r,a;for(a=8-e.length%8,r=0;0<=a?r<a:r>a;0<=a?r+=1:r-=1)e+="0";return function(){for(t=[],n=e.length,r=0;0<=n?r<n:r>n;r+=8)t.push(String.fromCharCode(parseInt(e.substr(r,8),2)));return t}().join("")+a.toString()},r.Tree.prototype.stringToBitString=function(e){var t,n,a,i,o,s,c;return c=e.split(""),s=parseInt(c.pop()),(c=(c=function(){for(t=[],n=0,i=(a=c).length;n<i;n++)o=a[n],t.push(r.CoreHelpers.lpad(o.charCodeAt(0).toString(2)));return t}()).join("")).substr(0,c.length-s)},r.Tree.prototype.bitValue=function(e){var t;return"undefined"!==typeof(t=this.leafCache)&&null!==t||this.generateLeafCache(),this.leafCache[e]},r.Tree.prototype.generateLeafCache=function(e,t){return this.leafCache="undefined"!==typeof this.leafCache&&null!==this.leafCache?this.leafCache:{},t=t||"",(e=e||this.root).isLeaf()?this.leafCache[e.value]=t:(this.generateLeafCache(e.left,t+"0"),this.generateLeafCache(e.right,t+"1"))},r.Tree.prototype.encodeTree=function(){return this.root.encode()},r.Tree.decodeTree=function(e){return new r.Tree(r.Tree.parseNode(e))},r.Tree.parseNode=function(e){var t;return t=new r.Tree.Node,r.CoreHelpers.isArray(e)?(t.left=r.Tree.parseNode(e[0]),t.right=r.Tree.parseNode(e[1])):t.value=e,t},r.Tree.Node=function(){return this.left=this.right=this.value=null,this},r.Tree.Node.prototype.isLeaf=function(){return this.left===this.right&&null===this.right},r.Tree.Node.prototype.encode=function(){return this.value?this.value:[this.left.encode(),this.right.encode()]};var j=Object.prototype.hasOwnProperty;r.TreeBuilder=function(e){return this.text=e,this},r.TreeBuilder.prototype.build=function(){var e,t;return t=this.buildFrequencyTable(),e=this.combineTable(t),r.Tree.decodeTree(this.compressCombinedTable(e))},r.TreeBuilder.prototype.buildFrequencyTable=function(){var e,t,n,r,a,i,o,s;for(s={},e=0,n=(t=this.text.split("")).length;e<n;e++)s[a=t[e]]="undefined"!==typeof s[a]&&null!==s[a]?s[a]:0,s[a]+=1;for(a in o=[],r=s)j.call(r,a)&&(i=r[a],o.push([i,a]));return o.sort(this.frequencySorter),o},r.TreeBuilder.prototype.frequencySorter=function(e,t){return e[0]>t[0]?1:e[0]<t[0]?-1:0},r.TreeBuilder.prototype.combineTable=function(e){for(var t,n;e.length>1;)t=e.shift(),n=e.shift(),e.push([t[0]+n[0],[t,n]]),e.sort(this.frequencySorter);return e[0]},r.TreeBuilder.prototype.compressCombinedTable=function(e){var t;return t=e[1],r.CoreHelpers.isArray(t)?[this.compressCombinedTable(t[0]),this.compressCombinedTable(t[1])]:t};n(53);var C=function(){var e=Object(u.i)().chainId,t=Object(u.h)(),n=Object(a.useState)({}),o=Object(f.a)(n,2),s=o[0],l=o[1],y=Object(a.useState)([]),g=Object(f.a)(y,2),j=g[0],C=g[1],x=function(e){return l(Object(p.a)(Object(p.a)({},s),e))},N=function(){var e=Object(m.a)(d.a.mark((function e(){return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,window.contract.getProjects();case 3:window.projects=e.sent,C(window.projects),x({message:""}),e.next=12;break;case 8:e.prev=8,e.t0=e.catch(0),console.error(e.t0),x({message:"Make sure you\u2019re on the right network! Then reload the page.",disabled:!0});case 12:case"end":return e.stop()}}),e,null,[[0,8]])})));return function(){return e.apply(this,arguments)}}();return Object(a.useEffect)((function(){return void 0===window.ethereum?x({message:"Please make sure you have MetaMask! Then reload the page.",disabled:!0}):(window.provider=new h.a.providers.Web3Provider(window.ethereum),window.contract=new h.a.Contract(w(e),v(),window.provider),N(),window.contract.on("ProjectCreated",N),window.contract.on("FundsDonated",N),window.contract.on("FundsClaimed",N),function(){window.contract.off("ProjectCreated",N),window.contract.off("FundsDonated",N),window.contract.off("FundsClaimed",N)})}),[]),i.a.createElement(b.Provider,{value:{store:s,updateStore:x}},i.a.createElement("main",null,i.a.createElement("header",null,i.a.createElement("h1",null,"qavah"),i.a.createElement(c.b,{to:"new",className:s.disabled&&"disabled"},"New project")),i.a.createElement("h2",null,"All projects"),i.a.createElement("div",{className:"projects"},j.map((function(t,n){var a=r.Tree.decodeTree(JSON.parse(t.imageMeta).tree).decode(t.encodedImage),o=t.fundedAmount.mul(100).div(t.requestedAmount).toNumber();return i.a.createElement(c.b,{to:t.id,className:"Project",key:n},i.a.createElement("pre",{className:"image"},E(a).replaceAll("W"," ").replaceAll("B","\u2022").match(/.{1,80}/g).join("\n")),i.a.createElement("div",{className:"content"},i.a.createElement("div",{className:"title"},i.a.createElement("h3",null,t.title)),i.a.createElement("p",{className:"description"},t.description),i.a.createElement("div",{className:"bottom"},i.a.createElement("div",null,i.a.createElement("div",{className:"progress"},i.a.createElement("div",{style:{width:o+"%"}})),i.a.createElement("span",{className:"amounts"},o,"% funded of ",i.a.createElement("b",null,h.a.utils.formatEther(t.requestedAmount)," ",T(e)))))))}))),i.a.createElement("div",{className:"Outlet"},i.a.createElement(u.b,null),i.a.createElement("div",{className:"overlay",onClick:function(){return t("/".concat(e))}})),s.message&&i.a.createElement("div",{className:"Message"},i.a.createElement("span",null,s.message),i.a.createElement("button",{onClick:function(){return s.disabled?window.location.reload():x({message:""})}},"x"))))};var x=function(){var e=Object(u.i)(),t=e.chainId,n=e.projectId,o=(Object(u.h)(),Object(a.useContext)(b).updateStore),s=Object(a.useState)(null),l=Object(f.a)(s,2),p=l[0],y=l[1],g=Object(a.useRef)();if(Object(a.useEffect)((function(){if(void 0===window.ethereum)return o({message:"Please make sure you have MetaMask! Then reload the page."});var e=new h.a.providers.Web3Provider(window.ethereum),r=new h.a.Contract(w(t),v(),e),a=function(){var e=Object(m.a)(d.a.mark((function e(){var t;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,r.getProject(n);case 3:if((t=e.sent).title){e.next=6;break}return e.abrupt("return");case 6:y(t),e.next=13;break;case 9:e.prev=9,e.t0=e.catch(0),console.error(e.t0),o({message:e.t0.message,disabled:!0});case 13:case"end":return e.stop()}}),e,null,[[0,9]])})));return function(){return e.apply(this,arguments)}}();return a(),r.on(r.filters.FundsDonated(n),a),r.on(r.filters.FundsClaimed(n),a),function(){r.off(r.filters.FundsDonated(n),a),r.off(r.filters.FundsClaimed(n),a)}}),[]),!p)return null;var j=r.Tree.decodeTree(JSON.parse(p.imageMeta).tree).decode(p.encodedImage),C=p.fundedAmount.mul(100).div(p.requestedAmount).toNumber(),x=h.a.utils.formatEther(p.fundedAmount.sub(p.claimedAmount));return i.a.createElement("div",{className:"ProjectInfo"},i.a.createElement("div",null,i.a.createElement("div",{className:"top"},i.a.createElement(c.b,{to:"/".concat(t)},"Back"),i.a.createElement("span",{className:"amounts"},C,"% funded of ",i.a.createElement("b",null,h.a.utils.formatEther(p.requestedAmount)," ",T(t)))),i.a.createElement("div",{className:"progress"},i.a.createElement("div",{style:{width:C+"%"}}))),i.a.createElement("pre",{className:"image"},E(j).replaceAll("W"," ").replaceAll("B","\u2022").match(/.{1,80}/g).join("\n")),i.a.createElement("div",{className:"content"},i.a.createElement("div",{className:"title"},i.a.createElement("h3",null,p.title)),i.a.createElement("p",{className:"description"},p.description),i.a.createElement("ul",null,p.donators.map((function(e,n){return i.a.createElement("li",{key:"li"+n},e," donated ",h.a.utils.formatEther(p.donatedAmounts[n])," ",T(t))}))),i.a.createElement("div",{className:"interact"},+window.ethereum.selectedAddress===+p.creator?+x?i.a.createElement("button",{onClick:Object(m.a)(d.a.mark((function e(){var r,a,i,s;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,window.ethereum.request({method:"eth_requestAccounts"});case 3:return r=new h.a.providers.Web3Provider(window.ethereum),a=r.getSigner(),i=new h.a.Contract(w(t),v(),a),e.next=8,i.claimProjectFunds(n);case 8:return s=e.sent,o({message:"Please wait\u2026"}),e.next=12,s.wait();case 12:e.next=18;break;case 14:e.prev=14,e.t0=e.catch(0),console.error(e.t0),o({message:e.t0.message});case 18:case"end":return e.stop()}}),e,null,[[0,14]])})))},"Claim ",x," ",T(t)):i.a.createElement("span",null,"Nothing to claim for now"):i.a.createElement(i.a.Fragment,null,i.a.createElement("span",null,"I wish to help with"),i.a.createElement("input",{ref:g,type:"number",name:"amount",placeholder:"1.0"}),i.a.createElement("button",{onClick:Object(m.a)(d.a.mark((function e(){var r,a,i,s,c;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,window.ethereum.request({method:"eth_requestAccounts"});case 3:return r=new h.a.providers.Web3Provider(window.ethereum),a=r.getSigner(),i=new h.a.Contract(w(t),v(),a),s=h.a.utils.parseEther(g.current.value),e.next=9,i.donateToProject(n,{value:s});case 9:return c=e.sent,o({message:"Please wait\u2026"}),e.next=13,c.wait();case 13:e.next=19;break;case 15:e.prev=15,e.t0=e.catch(0),console.error(e.t0),o({message:e.t0.message});case 19:case"end":return e.stop()}}),e,null,[[0,15]])})))},"Donate now")))))},N=n(25),A=n(44),O=n.n(A);var S=function(){var e=Object(u.i)().chainId,t=Object(u.h)(),n=Object(a.useContext)(b).updateStore;return i.a.createElement("form",{className:"NewProject",onSubmit:function(){var r=Object(m.a)(d.a.mark((function r(a){var i,o,s,c,u;return d.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.prev=0,a.preventDefault(),i=a.target.elements,r.next=5,window.ethereum.request({method:"eth_requestAccounts"});case 5:return o=new h.a.providers.Web3Provider(window.ethereum),s=o.getSigner(),c=new h.a.Contract(w(e),v(),s),r.next=10,c.createProject(i.title.value,i.description.value,h.a.utils.parseEther(i.requestedAmount.value),window.encoded,JSON.stringify({tree:window.huffman.encodeTree(),_w:80}));case 10:return u=r.sent,n({message:"Please wait\u2026"}),r.next=14,u.wait();case 14:t("/".concat(e)),r.next=21;break;case 17:r.prev=17,r.t0=r.catch(0),console.error(r.t0),n({message:r.t0.message});case 21:case"end":return r.stop()}}),r,null,[[0,17]])})));return function(e){return r.apply(this,arguments)}}()},i.a.createElement("textarea",{name:"title",placeholder:"Your project title",rows:"2"}),i.a.createElement("textarea",{name:"description",placeholder:"Give it some context\u2026",rows:"10"}),i.a.createElement("div",{className:"flex"},i.a.createElement("input",{type:"file",name:"image",onChange:P}),i.a.createElement("input",{name:"requestedAmount",type:"number",step:"0.001",placeholder:"Amount"})),i.a.createElement("div",{className:"action"},i.a.createElement(c.b,{to:"/".concat(e)},"Back"),i.a.createElement("button",{type:"submit"},"Create project")))};function P(e){var t=e.target.files[0],n=new FileReader;if(t){var a=document.createElement("img");a.width=80,a.title=t.name,document.body.appendChild(a);var i=new O.a({step:1,palette:[[0,0,0],[255,255,255]],algorithm:"atkinson"});n.onload=function(e){a.src=e.target.result,setTimeout(Object(m.a)(d.a.mark((function e(){var t,n,o,s,c;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:i.dither(a),t=document.querySelector("canvas:last-child"),n=t.getContext("2d"),o=n.getImageData(0,0*t.width/16/2,t.width,9*t.width/16).data,s=Object(N.a)(o).map((function(e){return e?"W":"B"})).join("").match(/.{1,4}/g).map((function(e){return e[0]})).join(""),c=s.replace(/([ \w])\1+/g,(function(e,t){return e.length+t})),window.huffman=r.treeFromText(c),window.encoded=window.huffman.encode(c);case 8:case"end":return e.stop()}}),e)}))))},n.readAsDataURL(t)}}s.a.render(i.a.createElement(i.a.StrictMode,null,i.a.createElement(c.a,null,i.a.createElement(u.e,null,i.a.createElement(u.c,{path:"/"},i.a.createElement(u.c,{index:!0,element:i.a.createElement(u.a,{to:"/4",replace:!0})}),i.a.createElement(u.c,{path:":chainId",element:i.a.createElement(C,null)},i.a.createElement(u.c,{path:"new",element:i.a.createElement(S,null)}),i.a.createElement(u.c,{path:":projectId",element:i.a.createElement(x,null)})))))),document.getElementById("root"))}},[[47,1,2]]]);
//# sourceMappingURL=main.70c04d36.chunk.js.map